<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Advanced Community Platform</title>
    <link rel="stylesheet" href="style.css" />
    <!-- PubNub SDK -->
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.2.0.min.js"></script>
    <!-- (Nếu dùng DOMPurify để bảo vệ đầu vào, thêm script sau) -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.4/dist/purify.min.js"></script> -->
  </head>
  <body>
    <header>
      <h1>Advanced Community Platform</h1>
      <div id="user-area">
        <!-- Thông tin người dùng (login/register, hiển thị username) -->
      </div>
      <button id="theme-toggle-btn">Toggle Dark Mode</button>
      <div id="notification-area">
        <!-- Thông báo realtime -->
      </div>
    </header>

    <main>
      <!-- Phần tạo bài viết (forum) -->
      <section id="create-post">
        <h2>Tạo bài viết mới</h2>
        <form id="post-form">
          <input type="text" id="post-title" placeholder="Tiêu đề" required />
          <textarea id="post-content" placeholder="Nội dung (Markdown hỗ trợ)" required></textarea>
          <select id="post-category">
            <option value="">Chọn chủ đề</option>
            <option value="general">Chung</option>
            <option value="news">Tin tức</option>
            <option value="discussion">Thảo luận</option>
            <option value="help">Trợ giúp</option>
          </select>
          <!-- File input cho đính kèm -->
          <input type="file" id="post-file" accept="image/*,video/*" />
          <!-- Xem trước file -->
          <div id="file-preview" class="file-preview hidden">
            <p>Preview:</p>
            <img id="preview-img" src="" alt="Preview ảnh" class="hidden" />
            <video id="preview-video" controls class="hidden"></video>
          </div>
          <!-- Hiển thị tiến trình upload -->
          <div id="upload-progress" class="upload-progress hidden">
            <progress id="progress-bar" value="0" max="100"></progress>
            <span id="progress-text"></span>
          </div>
          <button type="submit">Đăng bài</button>
        </form>
      </section>

      <!-- Phần tìm kiếm bài viết -->
      <section id="search-post">
        <h2>Tìm kiếm bài viết</h2>
        <input type="text" id="search-input" placeholder="Tìm theo tiêu đề..." />
      </section>

      <!-- Danh sách bài viết (forum) -->
      <section id="posts">
        <h2>Bảng tin</h2>
        <div id="post-list">
          <!-- Các bài viết được tải từ Firebase -->
        </div>
      </section>

      <!-- Phòng chat nhóm realtime -->
      <section id="chat-room">
        <h2>Phòng chat chung</h2>
        <div id="chat-messages" class="chat-messages">
          <!-- Lịch sử chat nhóm được lưu trong Firebase (groupChats) -->
        </div>
        <form id="chat-form">
          <input type="text" id="chat-input" placeholder="Nhập tin nhắn..." required />
          <button type="submit">Gửi</button>
        </form>
        <!-- Nút Chat với AI Chat Bot -->
        <button id="chatbot-btn">Chat với AI</button>
      </section>

      <!-- Danh sách người dùng: hiển thị username, trạng thái (online/offline) -->
      <section id="users">
        <h2>Danh sách người dùng</h2>
        <input type="text" id="user-search-input" placeholder="Tìm theo tên người dùng..." />
        <div id="users-container">
          <!-- Danh sách người dùng được tải từ Firebase (node "users" và "status") -->
        </div>
      </section>
    </main>

    <!-- Modal xác thực -->
    <div id="auth-modal" class="modal hidden">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2 id="auth-modal-title">Đăng nhập</h2>
        <form id="auth-form">
          <!-- Trường Username xuất hiện khi đăng ký -->
          <input type="text" id="auth-username" placeholder="Username" class="hidden" />
          <input type="email" id="auth-email" placeholder="Email" required />
          <input type="password" id="auth-password" placeholder="Mật khẩu" required />
          <button type="submit" id="auth-submit">Đăng nhập</button>
        </form>
        <p id="toggle-auth">
          Chưa có tài khoản? <a href="#" id="toggle-link">Đăng ký ngay</a>
        </p>
        <!-- Các nút đăng nhập bổ sung -->
        <button id="google-login">Đăng nhập Google</button>
        <button id="phone-login">Đăng nhập Phone</button>
        <!-- Container cho reCAPTCHA (Thông tin cần cho Phone Auth) -->
        <div id="recaptcha-container"></div>
      </div>
    </div>

    <!-- Khu vực bình luận cho bài viết -->
    <div id="comments-section" class="comments-section hidden">
      <h2>Bình luận</h2>
      <div id="comments-list"></div>
      <form id="comment-form">
        <textarea id="comment-input" placeholder="Viết bình luận..." required></textarea>
        <button type="submit">Gửi Bình Luận</button>
      </form>
    </div>

    <script type="module" src="main.js"></script>
  </body>
</html>
