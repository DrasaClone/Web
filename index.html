<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Nền Tảng Chat & Mạng Xã Hội Chất Lượng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Các thư viện bên ngoài được load qua CDN (không cần dòng lệnh cài đặt) -->
  <!-- Firebase (phiên bản compat để dễ tích hợp) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <!-- PubNub cho chat realtime -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pubnub/4.29.9/pubnub.umd.min.js"></script>
  <!-- Cloudinary cho upload hình ảnh -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-core/2.10.3/cloudinary-core-shrinkwrap.min.js"></script>
  <!-- Anime.js để tạo hiệu ứng động -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <!-- Agora.io cho gọi điện/video call -->
  <script src="https://sdk.agora.io/js/AgoraRTCSDK-4.10.0.js"></script>
  <!-- Facebook Comments Plugin -->
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v12.0"></script>

  <!-- Inline CSS - tất cả các style được quản lý ở đây -->
  <style>
    /* Cài đặt chung */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      background: #f5f5f5;
      transition: background 0.3s, color 0.3s;
    }
    header, footer {
      background: #3b5998;
      color: #fff;
      padding: 10px;
      text-align: center;
    }
    nav {
      text-align: center;
      margin: 10px;
    }
    nav button {
      margin: 0 5px;
      padding: 8px 12px;
      font-size: 16px;
      cursor: pointer;
    }
    .container { 
      max-width: 1200px; 
      margin: auto; 
      padding: 20px; 
    }
    .section { display: none; }
    .chat-window, #posts {
      border: 1px solid #ccc; 
      border-radius: 5px; 
      background: #fff; 
      max-height: 400px; 
      overflow-y: auto; 
      padding: 10px;
      margin-bottom: 20px;
    }
    .message, .post {
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    /* Profile section */
    #profile-info img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
    }
    /* Settings và custom themes */
    .dark-theme {
      background: #121212;
      color: #e0e0e0;
    }
    /* Demo cho hiệu ứng chuyển động */
    .fade-in {
      opacity: 0;
      animation: fadeIn 0.5s forwards;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    /* Responsive adjustments */
    @media (max-width: 768px) {
      nav button { font-size: 14px; }
    }
  </style>
</head>
<body>
  <!-- Header & Language Switcher -->
  <header>
    <h1>Nền Tảng Chat & Mạng Xã Hội Chất Lượng</h1>
    <div id="language-switcher">
      Chọn Ngôn Ngữ:
      <select id="lang-select" onchange="switchLanguage()">
        <option value="vi">Tiếng Việt</option>
        <option value="en">English</option>
        <!-- Thêm các ngôn ngữ khác -->
      </select>
    </div>
  </header>

  <!-- Navigation -->
  <nav>
    <button onclick="showSection('chat')">Chat Tổng Thể</button>
    <button onclick="showSection('social')">Mạng Xã Hội</button>
    <button onclick="showSection('profile')">Hồ Sơ</button>
    <button onclick="showSection('settings')">Cài Đặt</button>
  </nav>

  <!-- Container cho nội dung chính -->
  <div class="container">
    <!-- Chat Section (Kênh Chat Thế Giới) -->
    <section id="chat-section" class="section" style="display:block;">
      <h2>Phòng Chat Tổng Thể</h2>
      <div id="chat-window" class="chat-window"></div>
      <div id="message-input">
        <input type="text" id="msg-input" placeholder="Nhập tin nhắn..." style="width:80%;padding:10px;">
        <button id="send-msg-btn" style="padding:10px;">Gửi</button>
      </div>
    </section>

    <!-- Social Network Section -->
    <section id="social-section" class="section">
      <h2>Mạng Xã Hội</h2>
      <div id="posts"></div>
      <div id="post-create">
        <textarea id="post-content" placeholder="Viết bài của bạn..." style="width:100%;height:80px;padding:10px;"></textarea>
        <br>
        <label>Quyền riêng tư: </label>
        <select id="post-visibility">
          <option value="public">Công khai</option>
          <option value="friends">Bạn bè</option>
        </select>
        <button id="post-btn" style="padding:10px;margin-top:5px;">Đăng</button>
      </div>
      <!-- Facebook Comments Plugin -->
      <div class="fb-comments" data-href="http://YOUR_GITHUB_PAGES_URL" data-width="" data-numposts="5"></div>
    </section>

    <!-- Profile Section -->
    <section id="profile-section" class="section">
      <h2>Hồ Sơ của Bạn</h2>
      <div id="profile-info">
        <img id="avatar" src="default_avatar.png" alt="Avatar">
        <br>
        <input type="file" id="avatar-upload"><br><br>
        <input type="text" id="nickname" placeholder="Nickname" style="padding:5px;">
        <br><br>
        <input type="text" id="music-link" placeholder="Liên kết nhạc trên profile" style="width:80%;padding:5px;">
        <br><br>
        <!-- Các thông tin khác như email, số điện thoại được bảo mật theo yêu cầu -->
      </div>
    </section>

    <!-- Settings Section -->
    <section id="settings-section" class="section">
      <h2>Cài Đặt</h2>
      <div id="theme-settings">
        <label for="theme">Chọn giao diện:</label>
        <select id="theme">
          <option value="default">Default</option>
          <option value="dark">Dark</option>
          <!-- Thêm thêm tới 20 theme ở đây (có thể lựa chọn màu sắc RGB, hình nền) -->
        </select>
      </div>
      <br>
      <div id="privacy-settings">
        <label for="post-visibility">Quyền riêng tư bài đăng:</label>
        <select id="global-post-privacy">
          <option value="public">Công khai</option>
          <option value="friends">Chỉ bạn bè</option>
        </select>
      </div>
      <br>
      <div id="security-settings">
        <input type="checkbox" id="protect-profile">
        <label for="protect-profile">Bảo vệ trang cá nhân</label>
      </div>
      <br>
      <!-- Các cài đặt khác như tùy chỉnh font, màu sắc, hình nền, … -->
    </section>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 Nền Tảng Chat & Mạng Xã Hội Chất Lượng</p>
  </footer>

  <!-- Tất cả các mã JavaScript được tích hợp ngay bên dưới -->
  <script>
    /* ----------------------- PHẦN KHỞI TẠO & CẤU HÌNH ----------------------- */
    // Cấu hình Firebase - thay thế YOUR_XXX bằng thông tin của bạn
    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY",
      authDomain: "YOUR_FIREBASE_AUTH_DOMAIN",
      databaseURL: "YOUR_FIREBASE_DATABASE_URL",
      projectId: "YOUR_FIREBASE_PROJECT_ID",
      storageBucket: "YOUR_FIREBASE_STORAGE_BUCKET",
      messagingSenderId: "YOUR_FIREBASE_MESSAGING_SENDER_ID",
      appId: "YOUR_FIREBASE_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);

    // Khởi tạo PubNub
    const pubnub = new PubNub({
      publishKey: 'YOUR_PUBNUB_PUBLISH_KEY',
      subscribeKey: 'YOUR_PUBNUB_SUBSCRIBE_KEY'
    });

    // Khởi tạo Agora cho chức năng gọi điện/video
    const agoraClient = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });

    // Khởi tạo Cloudinary (tích hợp upload ảnh)
    const cl = cloudinary.Cloudinary.new();
    cl.config({
      cloud_name: 'YOUR_CLOUDINARY_CLOUD_NAME',
      secure: true
    });

    /* ----------------------- CHUYỂN GIỮA CÁC SECTION ----------------------- */
    function showSection(id) {
      document.querySelectorAll(".section").forEach(sec => { sec.style.display = "none"; });
      document.getElementById(id + "-section").style.display = "block";
    }

    /* ----------------------- HỖ TRỢ NGÔN NGỮ ----------------------- */
    function switchLanguage() {
      const lang = document.getElementById("lang-select").value;
      // Ở đây bạn có thể thay đổi nội dung của các thành phần để hỗ trợ đa ngôn ngữ
      // Ví dụ: nếu lang === "en" thì set innerText của các tiêu đề sang English
      console.log("Ngôn ngữ chuyển: " + lang);
    }

    /* ----------------------- CHỨC NĂNG CHAT ----------------------- */
    const chatWindow = document.getElementById("chat-window");
    const sendMsgBtn = document.getElementById("send-msg-btn");
    const msgInput = document.getElementById("msg-input");

    sendMsgBtn.addEventListener("click", function(){
      const msg = msgInput.value;
      if (msg.trim() !== "") {
        // Gửi tin nhắn qua PubNub
        pubnub.publish({
          channel: "global-chat",
          message: { 
            text: msg, 
            timestamp: Date.now(), 
            user: (firebase.auth().currentUser ? firebase.auth().currentUser.displayName : "Khách")
          }
        }, function(status, response) {
          if(status.error) {
            console.error("Lỗi PubNub:", status);
          } else {
            console.log("Tin nhắn đã gửi", response);
          }
        });
        msgInput.value = "";
      }
    });

    // Đăng ký nhận tin nhắn trên kênh toàn cục
    pubnub.subscribe({ channels: ["global-chat"] });
    pubnub.addListener({
      message: function(event) {
        const data = event.message;
        const messageDiv = document.createElement("div");
        messageDiv.className = "message fade-in";
        messageDiv.innerHTML = "<strong>" + data.user + ":</strong> " + data.text;
        chatWindow.appendChild(messageDiv);
        // Hiệu ứng động cho tin nhắn mới bằng anime.js (đã tích hợp sẵn CSS class "fade-in")
      }
    });

    /* ----------------------- CHỨC NĂNG MẠNG XÃ HỘI ----------------------- */
    const postBtn = document.getElementById("post-btn");
    postBtn.addEventListener("click", function(){
      const postContent = document.getElementById("post-content").value;
      if(postContent.trim() !== ""){
        const postsRef = firebase.database().ref("posts");
        const newPostRef = postsRef.push();
        newPostRef.set({
          content: postContent,
          user: (firebase.auth().currentUser ? firebase.auth().currentUser.displayName : "Khách"),
          timestamp: Date.now(),
          visibility: document.getElementById("post-visibility").value
        });
        document.getElementById("post-content").value = "";
      }
    });
    firebase.database().ref("posts").on("child_added", function(snapshot){
      const post = snapshot.val();
      const postDiv = document.createElement("div");
      postDiv.className = "post fade-in";
      postDiv.innerHTML = "<strong>" + post.user + ":</strong> " + post.content;
      document.getElementById("posts").appendChild(postDiv);
      anime({
        targets: postDiv,
        translateY: [-20, 0],
        opacity: [0, 1],
        duration: 500,
        easing: 'easeOutExpo'
      });
    });

    /* ----------------------- CHỨC NĂNG THAY ĐỔI THEME ----------------------- */
    const themeSelect = document.getElementById("theme");
    themeSelect.addEventListener("change", function(){
      const selected = themeSelect.value;
      document.body.className = "";  // Reset tất cả class
      if(selected === "dark"){
        document.body.classList.add("dark-theme");
      }
      // Nếu có thêm theme nâng cao, bạn có thể thực hiện các chuyển đổi màu sắc, hình nền, … tại đây
      // Lưu cài đặt người dùng trên Firebase nếu cần thiết
      if(firebase.auth().currentUser){
        firebase.database().ref("users/" + firebase.auth().currentUser.uid + "/settings").update({ theme: selected });
      }
    });

    /* ----------------------- CHỨC NĂNG ĐĂNG NHẬP ----------------------- */
    // Đăng nhập bằng email/password
    function signInWithEmail(email, password) {
      firebase.auth().signInWithEmailAndPassword(email, password)
        .catch(function(error) { console.error("Lỗi đăng nhập:", error); });
    }
    // Đăng nhập bằng Google
    function signInWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .catch(error => console.error("Lỗi Google login:", error));
    }
    // Đăng nhập bằng số điện thoại (cần bổ sung UI riêng theo Firebase Phone Auth)

    /* ----------------------- CHỨC NĂNG PROFILE & UPLOAD ẢNH ----------------------- */
    document.getElementById("avatar-upload").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if(file){
        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", "YOUR_UPLOAD_PRESET");
        fetch(`https://api.cloudinary.com/v1_1/YOUR_CLOUDINARY_CLOUD_NAME/image/upload`, {
          method: "POST",
          body: formData
        })
        .then(resp => resp.json())
        .then(data => {
          document.getElementById("avatar").src = data.secure_url;
          // Cập nhật avatar trong Firebase Profile
          if(firebase.auth().currentUser){
            firebase.database().ref("users/" + firebase.auth().currentUser.uid + "/profile").update({ avatar: data.secure_url });
          }
        });
      }
    });

    /* ----------------------- ONLINE/OFFLINE & TÍNH NĂNG KHÁC ----------------------- */
    window.addEventListener("online", () => { console.log("Đang Online"); });
    window.addEventListener("offline", () => { console.log("Đang Offline"); });
    // Hỗ trợ thông báo chat dạng bong bóng, cập nhật thời gian thực, kiểm soát trạng thái (có thể tích hợp thêm plugin hoặc sử dụng Firebase presence)
    
    // Ngăn tắt màn hình: sử dụng Wake Lock API nếu trình duyệt hỗ trợ
    if ('wakeLock' in navigator) {
      let wakeLock = null;
      async function requestWakeLock() {
        try { wakeLock = await navigator.wakeLock.request('screen'); }
        catch (err) { console.error("Lỗi Wake Lock: ", err); }
      }
      requestWakeLock();
    }

    /* ----------------------- CHỨC NĂNG PHÁT TRỰC TIẾP ÂM NHẠC ----------------------- */
    // Ví dụ: chèn một Audio element với nguồn lấy từ Audiomack
    function initAudioPlayer() {
      const audioPlayer = document.createElement("audio");
      audioPlayer.controls = true;
      audioPlayer.src = "https://source.audiomack.com/your-track.mp3"; // Bạn cần cấu hình đúng nguồn phát
      document.body.appendChild(audioPlayer);
    }
    // initAudioPlayer();

    /* ----------------------- CHỨC NĂNG GỌI ĐIỆN & VIDEO CALL ----------------------- */
    // Tích hợp Agora.io: Đây là phần rất phức tạp, bạn cần xây dựng UI riêng cho cuộc gọi đơn/lưỡng, group call...
    // Ví dụ: một hàm khởi tạo cuộc gọi video (chi tiết sẽ phụ thuộc vào logic của bạn)
    function startVideoCall(channelName) {
      agoraClient.init("YOUR_AGORA_APP_ID", () => {
        console.log("Agora client initialized");
        // Tiếp tục quá trình join kênh, thiết lập stream, v.v…
      }, (err) => {
        console.error("Agora init error: ", err);
      });
    }

    /* ----------------------- CHỨC NĂNG GAME & GIẢI TRÍ ----------------------- */
    // Bạn có thể tạo một container đặc biệt cho game và sau đó load từng game (ví dụ: Tic Tac Toe, Snake, etc).
    // Dưới đây chỉ là placeholder cho một trò chơi mẫu.
    function initGame() {
      const gameContainer = document.createElement("div");
      gameContainer.innerHTML = "<h3>Trò chơi: Tic Tac Toe</h3><p>Logic của trò chơi sẽ được chạy ở đây.</p>";
      document.body.appendChild(gameContainer);
    }
    // initGame();

    /* ----------------------- PHÍM TẮT VÀ TÍNH NĂNG THÊM ----------------------- */
    // Ví dụ: khi nhấn Ctrl+Enter để gửi tin nhắn
    document.addEventListener("keydown", function(event){
      if(event.ctrlKey && event.key === "Enter"){
        sendMsgBtn.click();
      }
    });

    // Các chức năng bổ sung khác như hệ thống bạn bè, gợi ý kết bạn, danh sách trò chuyện riêng, báo cáo người dùng, … 
    // sẽ cần tạo thêm các node trên Firebase (chẳng hạn: "friends", "user_profiles", "conversations", …) và logic tương ứng.
    // Đồng thời, bạn cũng nên thêm hệ thống mã hoá, chống sao chép mã (các đoạn mã “đánh lạc hướng” được nhúng vào các phần comment hoặc tính năng dynamic load) theo yêu cầu.

    /* ----------------------- LƯU DỮ LIỆU VÀ PHÂN TÍCH ----------------------- */
    // Tất cả dữ liệu (thông tin cá nhân, cài đặt, bài đăng, chat, trạng thái online, …) được lưu trữ trên Firebase Realtime Database.
    // Điều này đảm bảo khi người dùng load lại hay đăng nhập trên máy mới, tất cả thông tin đều được khôi phục.

  </script>
</body>
</html>
