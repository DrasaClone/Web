<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Nền Tảng Xã Hội</title>
  <!-- Sử dụng một số reset CSS cơ bản -->
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f2f2f2; }
    header { background: #333; color: #fff; padding: 10px; }
    header h1 { margin: 0; }
    nav ul { list-style: none; padding: 0; display: flex; }
    nav ul li { margin-right: 15px; }
    nav ul li a { color: #fff; text-decoration: none; }
    section { padding: 20px; margin-bottom: 10px; background: #fff; }
    .container { max-width: 900px; margin: auto; }
    input, textarea, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    button { cursor: pointer; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    .col-half { flex: 1; min-width: 300px; }
    /* Style cho hộp chat, diễn đàn */
    #chatBox, #forumPosts { border: 1px solid #ccc; background: #fafafa; padding: 10px; height: 200px; overflow-y: scroll; }
    .animated { background: #e6e6ff; padding: 10px; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Nền Tảng Social</h1>
      <nav>
        <ul>
          <li><a href="#home">Trang Chủ</a></li>
          <li><a href="#chat">Trò Chuyện</a></li>
          <li><a href="#forum">Diễn Đàn</a></li>
          <li><a href="#upload">Tải Ảnh</a></li>
          <li><a href="#profile">Tài Khoản</a></li>
          <li><a href="#comments">Bình Luận</a></li>
        </ul>
      </nav>
    </div>
  </header>
  
  <div class="container">
    <!-- Trang Chủ với hiệu ứng anime.js -->
    <section id="home" class="animated">
      <h2>Chào mừng bạn đến với Nền Tảng</h2>
      <p>Khám phá các tính năng</p>
    </section>
  
    <!-- Phần Chat sử dụng PubNub -->
    <section id="chat">
      <h2>Trò Chuyện Realtime</h2>
      <div id="chatBox"></div>
      <input type="text" id="chatMessage" placeholder="Nhập tin nhắn...">
      <button id="sendChat">Gửi Tin Nhắn</button>
    </section>
  
    <!-- Phần Diễn Đàn sử dụng Firebase Realtime Database -->
    <section id="forum">
      <h2>Diễn Đàn & Threads</h2>
      <div id="forumPosts"></div>
      <textarea id="forumMessage" placeholder="Khởi tạo chủ đề mới..."></textarea>
      <button id="postForum">Đăng Chủ Đề</button>
    </section>
  
    <!-- Phần Tải Ảnh qua Cloudinary -->
    <section id="upload">
      <h2>Tải Ảnh / Media</h2>
      <button id="upload_widget_button">Chọn và Tải Ảnh</button>
    </section>
  
    <!-- Phần Tài Khoản: Đăng nhập và đăng xuất -->
    <section id="profile">
      <h2>Tài Khoản & Đăng Nhập</h2>
      <!-- Form đăng nhập Email/Password -->
      <form id="emailLoginForm">
        <input type="email" id="email" placeholder="Email của bạn" required>
        <input type="password" id="password" placeholder="Mật khẩu" required>
        <button type="submit">Đăng Nhập bằng Email</button>
      </form>
      <!-- Đăng nhập Google -->
      <button id="googleSignIn">Đăng Nhập bằng Google</button>
      <!-- Đăng nhập bằng Phone (SMS) -->
      <div>
        <input type="text" id="phone" placeholder="Số điện thoại (ví dụ: +84123456789)">
        <button id="phoneSignIn">Gửi mã SMS</button>
        <div id="recaptcha-container"></div>
        <form id="phoneVerifyForm">
          <input type="text" id="verificationCode" placeholder="Nhập mã xác minh" required>
          <button type="submit">Xác Minh Số</button>
        </form>
      </div>
      <!-- Nút Đăng xuất -->
      <button id="logoutBtn">Đăng Xuất</button>
    </section>
  
    <!-- Phần Bình Luận Facebook -->
    <section id="comments">
      <h2>Bình Luận Facebook</h2>
      <!-- Lưu ý: Hãy thay data-href thành URL của trang Github Pages của bạn -->
      <div class="fb-comments" data-href="https://drasaclone.github.io/Web" data-width="100%" data-numposts="100"></div>
    </section>
  </div>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
  
  <!-- PubNub SDK -->
  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.33.0.min.js"></script>
  
  <!-- Cloudinary Upload Widget -->
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
  
  <!-- Anime.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  
  <!-- Facebook SDK -->
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v15.0"></script>
  
  <script>
    /***********************
     * 1. Cấu hình Firebase
     ***********************/
    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID",
      databaseURL: "YOUR_DATABASE_URL"
    };
    // Khởi tạo Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    const firestore = firebase.firestore();
    
    /***********************
     * 2. Cấu hình PubNub cho Chat Realtime
     ***********************/
    const pubnub = new PubNub({
      publishKey: 'YOUR_PUBNUB_PUBLISH_KEY',
      subscribeKey: 'YOUR_PUBNUB_SUBSCRIBE_KEY',
      uuid: "user-" + Math.floor(Math.random() * 10000)
    });
    
    // Đăng ký kênh chat
    pubnub.subscribe({ channels: ['chat'] });
    // Lắng nghe tin nhắn mới
    pubnub.addListener({
      message: function(event) {
        let messageData = event.message;
        const chatBox = document.getElementById('chatBox');
        let msgDiv = document.createElement('div');
        msgDiv.textContent = messageData.user + ": " + messageData.text;
        chatBox.appendChild(msgDiv);
      }
    });
    
    // Gửi tin nhắn chat
    document.getElementById("sendChat").addEventListener("click", function() {
      const messageText = document.getElementById("chatMessage").value;
      const user = auth.currentUser ? (auth.currentUser.email || auth.currentUser.phoneNumber) : "Anonymous";
      pubnub.publish({
        channel: 'chat',
        message: { user: user, text: messageText }
      }, function(status, response) {
        if (status.error) {
          console.error("Lỗi gửi tin:", status);
        } else {
          console.log("Tin đã được gửi với timetoken:", response.timetoken);
        }
      });
    });
    
    /***********************
     * 3. Tích hợp đăng nhập với Firebase Auth
     * - Email/Password, Google, Phone (SMS)
     ***********************/
    // Đăng nhập Email/Password
    document.getElementById("emailLoginForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          console.log("Đăng nhập thành công:", userCredential.user.email);
        })
        .catch((error) => {
          console.error("Lỗi đăng nhập:", error.message);
        });
    });
    
    // Đăng nhập với Google
    document.getElementById("googleSignIn").addEventListener("click", function() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then((result) => {
          console.log("Đăng nhập Google thành công:", result.user.email);
        })
        .catch((error) => {
          console.error("Lỗi Google Sign In:", error.message);
        });
    });
    
    // Đăng nhập bằng Phone (SMS)
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
      'size': 'invisible',
      'callback': function(response) {
        // Xử lý khi reCAPTCHA được giải quyết
      }
    });
    
    document.getElementById("phoneSignIn").addEventListener("click", function() {
      const phoneNumber = document.getElementById("phone").value;
      firebase.auth().signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
        .then((confirmationResult) => {
          window.confirmationResult = confirmationResult;
          console.log("SMS đã được gửi!");
        }).catch((error) => {
          console.error("Lỗi gửi SMS:", error.message);
        });
    });
    
    document.getElementById("phoneVerifyForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const code = document.getElementById("verificationCode").value;
      window.confirmationResult.confirm(code)
        .then((result) => {
          console.log("Xác minh thành công, số:", result.user.phoneNumber);
        })
        .catch((error) => {
          console.error("Lỗi xác minh mã:", error.message);
        });
    });
    
    // Chức năng Đăng xuất
    document.getElementById("logoutBtn").addEventListener("click", function() {
      auth.signOut().then(() => {
        console.log("Đã đăng xuất người dùng.");
      }).catch((error) => {
        console.error("Lỗi đăng xuất:", error);
      });
    });
    
    /***********************
     * 4. Diễn đàn: Đăng bài và tải bài viết từ Firebase Realtime Database
     ***********************/
    document.getElementById("postForum").addEventListener("click", function() {
      const message = document.getElementById("forumMessage").value;
      const user = auth.currentUser ? (auth.currentUser.email || auth.currentUser.phoneNumber) : "Anonymous";
      // Lưu bài viết vào phần 'forumPosts'
      const postRef = database.ref('forumPosts').push();
      postRef.set({
        user: user,
        message: message,
        timestamp: Date.now()
      });
      document.getElementById("forumMessage").value = "";
    });
    
    // Hiển thị bài viết khi có bài mới
    database.ref('forumPosts').on('child_added', function(snapshot) {
      const data = snapshot.val();
      const forumPostsDiv = document.getElementById("forumPosts");
      let postDiv = document.createElement("div");
      postDiv.textContent = data.user + ": " + data.message;
      forumPostsDiv.appendChild(postDiv);
    });
    
    /***********************
     * 5. Cloudinary Upload Widget cho tải ảnh
     ***********************/
    var myWidget = cloudinary.createUploadWidget({
      cloudName: 'YOUR_CLOUD_NAME', 
      uploadPreset: 'YOUR_UPLOAD_PRESET'
    }, (error, result) => { 
      if (!error && result && result.event === "success") { 
        console.log('Ảnh đã tải lên thành công:', result.info);
        // Bạn có thể lưu URL ảnh (result.info.secure_url) lên cơ sở dữ liệu của mình
      }
    });
    
    document.getElementById("upload_widget_button").addEventListener("click", function(){
      myWidget.open();
    }, false);
    
    /***********************
     * 6. Hiệu ứng với anime.js
     ***********************/
    anime({
      targets: '.animated',
      translateX: 250,
      duration: 1500,
      loop: true,
      direction: 'alternate',
      easing: 'easeInOutSine'
    });
  </script>
</body>
</html>
