<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Nền tảng Chat & Mạng Xã Hội Đỉnh Cao</title>
  <style>
    /* Reset & thiết lập cơ bản */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #f0f2f5; transition: background 0.5s, color 0.5s; }
    header { background: #4267b2; color: #fff; padding: 10px; }
    nav ul { list-style: none; display: flex; gap: 20px; }
    nav ul li { cursor: pointer; padding: 8px; border-radius: 4px; transition: background 0.3s; }
    nav ul li:hover { background: rgba(255,255,255,0.2); }
    #themeSwitcher { display: inline-block; margin-left: auto; }
    /* Các khu vực trang */
    #loginSection, #mainSection { padding: 20px; }
    form input, form button, form textarea, form select {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button { cursor: pointer; }
    /* Chat */
    #chatMessages { height: 250px; overflow-y: auto; background: #fff; padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; }
    .chatMessage { padding: 5px; margin-bottom: 5px; border-radius: 4px; background: #e9ebee; }
    /* Các phần riêng tư */
    section { margin-top: 20px; }
    /* Các hiệu ứng và giao diện cá nhân hoá sẽ được thêm dưới đây */
    /* Các theme mẫu - bạn có thể mở rộng (các class này được lưu / áp dụng động) */
    .dark { background: #18191a; color: #e4e6eb; }
    .light { background: #fff; color: #050505; }
    /* Cũng có thể thêm các theme khác: blue, red, green, … */
  </style>
  <!-- Các thư viện JS từ CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <!-- Firebase SDK 9+ -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
  <!-- PubNub -->
  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.29.9.js"></script>
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.2/dist/supabase.min.js"></script>
  <!-- Agora.io (chỉ là ví dụ, tải SDK phù hợp khi cần) -->
  <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
  <!-- Các thư viện khác nếu cần (lưu ý: không dùng CLI hay thiết lập ngoại trừ qua CDN) -->
</head>
<body>
  <div id="app">
    <!-- Màn hình đăng nhập -->
    <div id="loginSection">
      <h2>Đăng nhập / Đăng ký</h2>
      <form id="loginForm">
        <input type="text" id="nickname" placeholder="Nhập nickname (bắt buộc)" required>
        <input type="email" id="email" placeholder="Nhập email" required>
        <input type="password" id="password" placeholder="Nhập mật khẩu" required>
        <button type="submit">Đăng nhập</button>
        <button type="button" id="registerBtn">Đăng ký</button>
        <hr>
        <button type="button" id="googleLogin">Đăng nhập bằng Google</button>
        <button type="button" id="phoneLogin">Đăng nhập bằng SĐT</button>
      </form>
    </div>
    <!-- Ứng dụng chính: giao diện, chat, social, bạn bè, cài đặt, … -->
    <div id="mainSection" style="display:none;">
      <!-- Header/navigation -->
      <header>
        <nav>
          <ul>
            <li id="navChat">Chat</li>
            <li id="navSocial">Mạng Xã Hội</li>
            <li id="navFriends">Bạn Bè</li>
            <li id="navSettings">Cài Đặt</li>
            <li id="navGames">Trò Chơi</li>
          </ul>
          <div id="themeSwitcher">Chọn Theme</div>
        </nav>
      </header>
      <!-- Giao diện chat -->
      <section id="chatInterface">
        <div id="globalChat">
          <h2>Kênh Chat Thế Giới</h2>
          <div id="chatMessages"></div>
          <input type="text" id="chatInput" placeholder="Nhập tin nhắn...">
          <button id="chatSend">Gửi</button>
        </div>
        <!-- Khu vực chat riêng (danh sách bạn bè & khung chat riêng tư) -->
        <div id="privateChats">
          <h2>Chat Riêng Tư</h2>
          <div id="friendsList"><!-- Danh sách bạn bè sẽ load từ DB --></div>
          <div id="privateChatWindow"><!-- Khung chat riêng sẽ được tạo động --></div>
        </div>
      </section>
      <!-- Mạng xã hội: bài đăng, bình luận, giới hạn xem, … -->
      <section id="socialFeed" style="display:none;">
        <h2>Bảng Tin</h2>
        <div id="postsContainer"><!-- Các bài đăng sẽ được load từ DB --></div>
        <form id="postForm">
          <textarea id="postContent" placeholder="Chia sẻ điều gì đó..."></textarea>
          <select id="postPrivacy">
            <option value="public">Công khai</option>
            <option value="friends">Bạn bè</option>
            <option value="private">Chỉ mình tôi</option>
          </select>
          <button type="submit">Đăng Bài</button>
        </form>
      </section>
      <!-- Danh sách bạn bè & gợi ý kết bạn -->
      <section id="friendsSection" style="display:none;">
        <h2>Bạn Bè</h2>
        <div id="friendSuggestions"><!-- Gợi ý kết bạn sẽ được tính toán --></div>
        <input type="text" id="searchFriend" placeholder="Tìm kiếm bạn bè...">
        <div id="searchResults"><!-- Kết quả tìm kiếm --></div>
      </section>
      <!-- Cài đặt cá nhân -->
      <section id="settingsSection" style="display:none;">
        <h2>Cài Đặt</h2>
        <div id="profileSettings">
          <h3>Hồ Sơ Cá Nhân</h3>
          <input type="file" id="avatarUpload"> Đổi ảnh đại diện<br>
          <input type="file" id="coverUpload"> Đổi ảnh bìa<br>
          <input type="text" id="colorPreference" placeholder="Màu ưa thích (RGB hoặc HEX)">
          <input type="url" id="musicLink" placeholder="Link nhạc trên profile (ví dụ Audiomack)">
        </div>
        <div id="uiSettings">
          <h3>Cài Đặt Giao Diện</h3>
          <div id="themeOptions"><!-- Các nút chọn theme sẽ sinh động ở đây --></div>
        </div>
        <div id="securitySettings">
          <h3>Bảo Mật</h3>
          <button id="enableSecurity">Kích hoạt bảo mật trang cá nhân</button>
        </div>
        <div id="otherSettings">
          <h3>Khác</h3>
          <input type="checkbox" id="antiCopy"> Kích hoạt chống sao chép mã
        </div>
      </section>
      <!-- Thông báo (popup, hiệu ứng bong bóng) -->
      <div id="notifications"><!-- Sẽ xuất hiện các thông báo real-time --></div>
      <!-- Modal gọi điện (video/audio call) -->
      <div id="callModal" style="display:none;">
        <h2>Cuộc Gọi</h2>
        <div id="callContainer"><!-- Bộ giao diện Agora.io sẽ khởi tạo tại đây --></div>
        <button id="endCall">Kết Thúc Cuộc Gọi</button>
      </div>
      <!-- Phần trò chơi giải trí -->
      <section id="gamesSection" style="display:none;">
        <h2>Trò Chơi Giải Trí</h2>
        <div id="gamesList">
          <!-- Ví dụ: danh sách ít nhất 30 trò chơi với liên kết tới game thực tế -->
          <a href="https://example.com/game1" target="_blank">Game 1</a><br>
          <a href="https://example.com/game2" target="_blank">Game 2</a><br>
          <!-- ... thêm game 3 đến game 30+ -->
        </div>
      </section>
    </div>
  </div>

  <!-- TOÀN BỘ SCRIPT: JS inline xử lý logic -->
  <script>
    /***********************
     * CẤU HÌNH TOÀN CỤC *
     ***********************/
    // Firebase Configuration – thay thế thông tin thực của bạn
    const firebaseConfig = {
  apiKey: "AIzaSyCeYwTT7E8bi7bccIrc20MTe5S4r0e0wUI",
  authDomain: "webai-7642b.firebaseapp.com",
  databaseURL: "https://webai-7642b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "webai-7642b",
  storageBucket: "webai-7642b.firebasestorage.app",
  messagingSenderId: "967881370128",
  appId: "1:967881370128:web:e5c4b06e4f70f55a68b895",
  measurementId: "G-61XJ390Q30"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Khởi tạo PubNub cho kênh chat toàn cầu
    const pubnub = new PubNub({
      publishKey : 'pub-c-9ad32978-37b1-4f15-bc57-bac1884507a4',
      subscribeKey : 'YOUR_PUBNUB_SUBSCRIBE_KEY',
      uuid: "USER_UUID"  // Sẽ được cập nhật khi người dùng đăng nhập
    });

    // Khởi tạo Supabase (nếu dùng)
    const supabaseUrl = 'https://epoojnqqbdvybvunzuni.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVwb29qbnFxYmR2eWJ2dW56dW5pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYzNjk4NDAsImV4cCI6MjA2MTk0NTg0MH0.e3K4FxuObHZVC_zVIzRSTLsXwXK6neA41vZNsZ3pWQg';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // Khởi tạo Agora.io – (để gọi điện, video call…)
    let agoraClient = AgoraRTC.createClient({mode: "rtc", codec: "vp8"});
    // TODO: Cấu hình Agora với App ID của bạn khi cần.

    // Các biến trạng thái chính
    let currentUser = null;
    let currentTheme = 'default';

    /************************
     * HÀM HỖ TRỢ & MODULES *
     ************************/
    // Hàm chuyển đổi hiển thị các khung nội dung (chat, social, bạn bè, cài đặt, trò chơi)
    function switchView(viewId) {
      const sections = ["chatInterface", "socialFeed", "friendsSection", "settingsSection", "gamesSection"];
      sections.forEach(id => document.getElementById(id).style.display = "none");
      if(viewId) document.getElementById(viewId).style.display = "block";
    }

    // Khởi tạo các sự kiện cho điều hướng (menu)
    document.getElementById("navChat").addEventListener("click", () => switchView("chatInterface"));
    document.getElementById("navSocial").addEventListener("click", () => switchView("socialFeed"));
    document.getElementById("navFriends").addEventListener("click", () => switchView("friendsSection"));
    document.getElementById("navSettings").addEventListener("click", () => switchView("settingsSection"));
    document.getElementById("navGames").addEventListener("click", () => switchView("gamesSection"));

    // Xử lý đăng nhập qua form
    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const nickname = document.getElementById("nickname").value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      // Sử dụng Firebase Auth để đăng nhập
      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          currentUser = userCredential.user;
          // Lưu nickname (nếu là lần đầu đăng nhập)
          db.ref('users/' + currentUser.uid).update({nickname});
          showMainApp();
        })
        .catch(error => console.error("Lỗi đăng nhập:", error));
    });

    // Xử lý đăng ký
    document.getElementById("registerBtn").addEventListener("click", function(){
      const nickname = document.getElementById("nickname").value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          currentUser = userCredential.user;
          db.ref('users/' + currentUser.uid).set({nickname});
          showMainApp();
        })
        .catch(error => console.error("Lỗi đăng ký:", error));
    });

    // Đăng nhập bằng Google
    document.getElementById("googleLogin").addEventListener("click", function(){
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then(result => {
          currentUser = result.user;
          // Bạn có thể cập nhật nickname hoặc các thông tin bổ sung sau khi đăng nhập
          showMainApp();
        })
        .catch(error => console.error("Google Login lỗi:", error));
    });

    // Sau khi người dùng đăng nhập thành công: hiển thị giao diện chính
    function showMainApp(){
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("mainSection").style.display = "block";
      loadGlobalChat();
      initializeThemeSwitcher();
      // Các hàm tải thêm: danh sách bạn bè, những cài đặt cá nhân,…

      // TODO: Cấu hình lưu trữ trạng thái (các thiết lập, nickname, theme…) trên realtime DB để khôi phục khi load lại.
    }

    // Chức năng chat toàn cầu sử dụng PubNub
    function loadGlobalChat(){
      pubnub.subscribe({ channels: ['globalChat'] });
      pubnub.addListener({
        message: function(messageEvent) {
          displayMessage(messageEvent.message);
        }
      });
      document.getElementById("chatSend").addEventListener("click", function(){
        const messageContent = document.getElementById("chatInput").value;
        if(messageContent.trim() !== ""){
          pubnub.publish({
            channel: 'globalChat',
            message: { sender: currentUser.uid, nickname: currentUser.nickname || "Anonymous", message: messageContent, timestamp: Date.now() }
          });
          document.getElementById("chatInput").value = "";
        }
      });
    }

    // Hiển thị tin nhắn chat
    function displayMessage(msgObj){
      const msgDiv = document.createElement("div");
      msgDiv.className = "chatMessage";
      msgDiv.innerHTML = "<strong>" + (msgObj.nickname || "User") + ":</strong> " + msgObj.message;
      document.getElementById("chatMessages").appendChild(msgDiv);
      // Sử dụng anime.js cho hiệu ứng hiện ra
      anime({ targets: msgDiv, opacity: [0, 1], duration: 500, easing: 'easeOutQuad' });
    }

    // Hàm khởi tạo theme (ít nhất 20 theme)
    function initializeThemeSwitcher(){
      let themes = ["default", "dark", "light", "blue", "green", "red", "purple", "orange", "pink", "cyan",
                    "brown", "magenta", "lime", "teal", "amber", "indigo", "violet", "olive", "maroon", "navy"];
      let themeContainer = document.getElementById("themeSwitcher");
      themes.forEach(theme => {
        let btn = document.createElement("button");
        btn.innerText = theme;
        // Ví dụ: dùng tên theme làm background đơn giản – bạn có thể tinh chỉnh cho đẹp hơn
        btn.style.backgroundColor = theme;
        btn.style.color = "#fff";
        btn.style.margin = "2px";
        btn.addEventListener("click", () => {
          currentTheme = theme;
          document.body.className = theme;
          if(currentUser) {
            db.ref('users/' + currentUser.uid).update({theme: theme});
          }
        });
        themeContainer.appendChild(btn);
      });
    }

    // Hàm phòng chống tắt màn hình (sử dụng Wake Lock API nếu có)
    function preventScreenLock(){
      if ('wakeLock' in navigator) {
        navigator.wakeLock.request('screen').catch(console.error);
      }
    }
    preventScreenLock();

    // Hàm tích hợp hệ thống emoji, phím tắt…
    function initializeEmojiPicker(){
      // TODO: Tích hợp thư viện emoji (nếu có thể load qua CDN) và gắn xử lý cho ô chat, bài đăng.
    }

    // Hàm cho phần trò chơi (ít nhất 30 trò chơi)
    function loadGames(){
      // Trong mẫu này, một số game đã được liệt kê dưới phần HTML; bạn có thể load động nếu cần.
      // TODO: Nếu muốn tích hợp các game mini, bạn có thể nhúng iframe hoặc tạo chống gọi các script chơi game.
    }
    loadGames();

    // Tích hợp tính năng gọi điện/video call sử dụng Agora.io
    function startCall(type, channelName){
      // type: "audio", "video", "group"
      // TODO: Thực hiện khởi tạo cuộc gọi theo tài liệu của Agora.io và hiển thị giao diện trong #callModal
      document.getElementById("callModal").style.display = "block";
      // Gọi agoraClient.join(...) và thiết lập các handler.
    }
    document.getElementById("endCall").addEventListener("click", function(){
      // TODO: Dừng cuộc gọi, giải phóng tài nguyên Agora.
      document.getElementById("callModal").style.display = "none";
    });

    // Hệ thống báo cáo người dùng + vote báo cáo
    function reportUser(userId, reason){
      // TODO: Gửi báo cáo lên DB, tính toán vote, hiển thị người dùng bị báo cáo trên trang chính.
    }

    // Các xử lý khác: cập nhật profile, upload ảnh bằng Cloudinary, lưu trữ dữ liệu chat, cài đặt… 
    // → Các API của Cloudinary, Back4App cần được gọi qua HTTP (fetch) hoặc các thư viện JS do họ cung cấp.

    // Theo dõi trạng thái đăng nhập Firebase
    window.onload = function(){
      auth.onAuthStateChanged(user => {
        if(user){
          currentUser = user;
          showMainApp();
        } else {
          document.getElementById("loginSection").style.display = "block";
        }
      });
      initializeEmojiPicker();
      // TODO: Các cài đặt ban đầu khác.
    };
  </script>
</body>
</html>
