<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Nền tảng Chat Realtime với Hiệu ứng Anime.js</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Firebase JS SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <!-- PubNub SDK -->
  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.29.9.min.js"></script>
  
  <!-- Anime.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .login-section,
    .chat-section {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
      opacity: 0; /* Khởi tạo ẩn để áp dụng hiệu ứng fade-in */
    }
    .login-section h2,
    .chat-section h2 {
      margin-top: 0;
    }
    #chat-window {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 10px;
      background-color: #f9f9f9;
    }
    input,
    button {
      margin: 5px 0;
      padding: 5px;
      font-size: 1rem;
    }
    .message {
      opacity: 0;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h1>Nền tảng Chat Realtime với Hiệu ứng Anime.js</h1>
  
  <!-- Phần đăng nhập -->
  <div class="login-section">
    <h2>Đăng nhập</h2>
    <!-- Đăng nhập bằng Google -->
    <div id="login-google">
      <button id="google-login">Đăng nhập với Google</button>
    </div>
    <hr>
    <!-- Đăng nhập bằng Email -->
    <div id="login-email">
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Mật khẩu">
      <button id="email-login">Đăng nhập/Đăng ký với Email</button>
    </div>
    <hr>
    <!-- Đăng nhập bằng Số điện thoại -->
    <div id="login-phone">
      <input type="text" id="phone-number" placeholder="Số điện thoại (VD: +849xxxxxxxx)">
      <div id="recaptcha-container"></div>
      <button id="send-otp">Gửi OTP</button><br>
      <input type="text" id="otp-code" placeholder="Nhập OTP">
      <button id="verify-otp">Xác thực OTP</button>
    </div>
  </div>
  
  <!-- Phần Chat -->
  <div class="chat-section">
    <h2>Phòng Chat</h2>
    <div id="chat-window"></div>
    <input type="text" id="message-input" placeholder="Nhập tin nhắn...">
    <button id="send-btn">Gửi</button>
  </div>
  
  <!-- Plugin bình luận Facebook -->
  <div id="fb-root"></div>
  <div class="fb-comments" data-href="https://drasaclone.github.io/Web" data-width="1000" data-numposts="1000"></div>
  
  <script>
    /* -------------------- CẤU HÌNH FIREBASE -------------------- */
    var firebaseConfig = {
  apiKey: "AIzaSyCeYwTT7E8bi7bccIrc20MTe5S4r0e0wUI",
  authDomain: "webai-7642b.firebaseapp.com",
  databaseURL: "https://webai-7642b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "webai-7642b",
  storageBucket: "webai-7642b.firebasestorage.app",
  messagingSenderId: "967881370128",
  appId: "1:967881370128:web:e5c4b06e4f70f55a68b895",
  measurementId: "G-61XJ390Q30"
    };
    firebase.initializeApp(firebaseConfig);
    
    /* -------------------- KHỞI TẠO PUBNUB -------------------- */
    var pubnub = new PubNub({
      publishKey: 'pub-c-9ad32978-37b1-4f15-bc57-bac1884507a4',
      subscribeKey: 'sub-c-0269ec54-430f-41b1-8a33-4200f566fcbb'
    });
    
    pubnub.subscribe({
      channels: ['chat']
    });
    
    pubnub.addListener({
      message: function(event) {
        var message = event.message;
        appendMessage(message);
      }
    });
    
    /* -------------------- HIỆU ỨNG TRÊN PAGE LOAD -------------------- */
    window.addEventListener('load', function() {
      // Hiệu ứng fade-in cho phần đăng nhập
      anime({
        targets: '.login-section',
        opacity: [0, 1],
        translateY: [-20, 0],
        duration: 1000,
        easing: 'easeOutExpo'
      });
      
      // Hiệu ứng fade-in cho phần chat
      anime({
        targets: '.chat-section',
        opacity: [0, 1],
        translateY: [20, 0],
        duration: 1000,
        delay: 500,
        easing: 'easeOutExpo'
      });
    });
    
    /* -------------------- XỬ LÝ ĐĂNG NHẬP -------------------- */
    
    // Đăng nhập bằng Google
    document.getElementById("google-login").addEventListener("click", function() {
      var provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .then(function(result) {
          console.log("Đăng nhập thành công:", result.user.displayName);
        })
        .catch(function(error) {
          console.error("Lỗi đăng nhập Google:", error);
        });
    });
    
    // Đăng nhập bằng Email
    document.getElementById("email-login").addEventListener("click", function() {
      var email = document.getElementById("email").value;
      var password = document.getElementById("password").value;
      
      firebase.auth().signInWithEmailAndPassword(email, password)
        .then(function(userCredential) {
          console.log("Đăng nhập thành công với Email:", userCredential.user.email);
        })
        .catch(function(error) {
          if (error.code === 'auth/user-not-found') {
            firebase.auth().createUserWithEmailAndPassword(email, password)
              .then(function(userCredential) {
                console.log("Tạo tài khoản Email thành công:", userCredential.user.email);
              })
              .catch(function(error) {
                console.error("Lỗi tạo người dùng Email:", error.message);
              });
          } else {
            console.error("Lỗi đăng nhập Email:", error.message);
          }
        });
    });
    
    // Đăng nhập bằng Số điện thoại: Gửi OTP
    document.getElementById("send-otp").addEventListener("click", function() {
      var phoneNumber = document.getElementById("phone-number").value;
      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        'size': 'invisible'
      });
      
      firebase.auth().signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
        .then(function(confirmationResult) {
          window.confirmationResult = confirmationResult;
          console.log("OTP đã được gửi đến số điện thoại:", phoneNumber);
        })
        .catch(function(error) {
          console.error("Lỗi gửi OTP:", error);
        });
    });
    
    // Xác thực OTP
    document.getElementById("verify-otp").addEventListener("click", function() {
      var otpCode = document.getElementById("otp-code").value;
      window.confirmationResult.confirm(otpCode)
        .then(function(result) {
          console.log("Xác thực số điện thoại thành công:", result.user.phoneNumber);
        })
        .catch(function(error) {
          console.error("OTP không chính xác:", error);
        });
    });
    
    /* -------------------- XỬ LÝ TIN NHẮN VÀ HIỆU ỨNG ANIME.JS -------------------- */
    // Hàm tạo và hiển thị tin nhắn với hiệu ứng anime.js
    function appendMessage(message) {
      var chatWindow = document.getElementById("chat-window");
      var p = document.createElement("p");
      p.className = "message";
      p.innerHTML = "<strong>" + message.sender + ":</strong> " + message.text;
      chatWindow.appendChild(p);
      
      // Tự động cuộn xuống dưới khi có tin mới
      chatWindow.scrollTop = chatWindow.scrollHeight;
      
      // Hiệu ứng fade-in và dịch chuyển từ dưới lên cho tin nhắn
      anime({
        targets: p,
        opacity: [0, 1],
        translateY: [20, 0],
        duration: 500,
        easing: 'easeOutExpo'
      });
    }
    
    // Xử lý gửi tin nhắn
    document.getElementById("send-btn").addEventListener("click", function() {
      var input = document.getElementById("message-input");
      var text = input.value.trim();
      if (text === "") return;
      
      var user = firebase.auth().currentUser;
      var senderName = user ? (user.displayName || user.email || user.phoneNumber) : "Anonymous";
      var message = { sender: senderName, text: text };
      
      // Gửi tin nhắn qua PubNub
      pubnub.publish({
        channel: 'chat',
        message: message
      });
      
      // Lưu tin nhắn vào Firebase Realtime Database
      firebase.database().ref('messages').push(message);
      input.value = "";
    });
    
    // Lấy và hiển thị tin nhắn đã lưu từ Firebase
    firebase.database().ref('messages').on('child_added', function(snapshot) {
      var message = snapshot.val();
      appendMessage(message);
    });
  </script>
  
  <!-- SDK Facebook cho bình luận -->
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v11.0"></script>
</body>
</html>
