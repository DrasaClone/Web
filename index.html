<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ultimate Chat & Social Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- C√°c th∆∞ vi·ªán animation & hi·ªáu ·ª©ng -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <!-- PubNub d√πng cho chat realtime -->
  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.29.9.min.js"></script>
  <!-- Firebase cho x√°c th·ª±c v√† realtime database -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <!-- Cloudinary Upload Widget cho upload ·∫£nh/video -->
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
  <!-- Agora.io cho g·ªçi ƒëi·ªán & video call -->
  <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
  <!-- T√πy ch·ªânh CSS n·ªôi b·ªô ‚Äì h·ªó tr·ª£ c√°c ch·∫ø ƒë·ªô s√°ng/t·ªëi, themes, hi·ªáu ·ª©ng -->
  <style>
    /* Reset v√† ƒë·ªãnh d·∫°ng c∆° b·∫£n */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; transition: background-color 0.3s, color 0.3s; }
    body.light { background-color: #f5f5f5; color: #333; }
    body.dark { background-color: #121212; color: #eee; }
    header {
      width: 100%;
      padding: 10px 20px;
      background: #0d6efd;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    /* Sidebar hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi d√πng, b·∫°n b√®, th√¥ng b√°o */
    #sidebar { 
      width: 250px; background: #ffffff; border-right: 1px solid #ddd; 
      height: calc(100vh - 50px); overflow-y: auto; float: left; 
    }
    /* Khu v·ª±c chat */
    #chat-container { 
      margin-left: 250px; height: calc(100vh - 50px);
      overflow-y: auto; padding: 20px; 
    }
    /* Trang m·∫°ng x√£ h·ªôi ‚Äì ·∫©n m·∫∑c ƒë·ªãnh */
    #social-container { 
      margin-left: 250px; height: calc(100vh - 50px); 
      overflow-y: auto; padding: 20px; display: none; 
    }
    /* Giao di·ªán ƒëƒÉng nh·∫≠p ƒë∆°n gi·∫£n */
    #login-page {
      width: 100vw; height: 100vh; display: flex; align-items: center;
      justify-content: center; background: #0d6efd; color: #fff;
    }
    /* Chat bubble style */
    .chat-bubble {
      padding: 10px; margin: 5px 0; border-radius: 10px; max-width: 70%;
    }
    .chat-bubble.sent { background: #0d6efd; color: #fff; align-self: flex-end; }
    .chat-bubble.received { background: #e9ecef; color: #333; align-self: flex-start; }
    /* Style cho danh s√°ch b·∫°n b√® & ng∆∞·ªùi d√πng online */
    .friend-item, .user-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #ddd; }
    .friend-item:hover, .user-item:hover { background: #f5f5f5; }
    /* Button, input style */
    button, input { padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
    input:focus { outline: none; border-color: #0d6efd; }
    /* Modal chung cho settings, emoji, games, video call */
    .modal {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%); background: #fff;
      z-index: 300; padding: 20px; border: 1px solid #ddd; display: none;
    }
    .theme-picker { margin: 10px; }
  </style>
</head>

<body class="light">
  <!-- Trang ƒëƒÉng nh·∫≠p -->
  <div id="login-page">
    <div id="login-box">
      <h2>ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</h2>
      <input type="text" id="login-nickname" placeholder="Nickname">
      <input type="email" id="login-email" placeholder="Email (n·∫øu c√≥)">
      <input type="password" id="login-password" placeholder="M·∫≠t kh·∫©u">
      <input type="text" id="login-phone" placeholder="S·ªë ƒëi·ªán tho·∫°i (n·∫øu c√≥)">
      <button id="login-btn">ƒêƒÉng nh·∫≠p/ƒêƒÉng k√Ω</button>
      <p>Ho·∫∑c ƒëƒÉng nh·∫≠p b·∫±ng Google</p>
      <button id="google-login-btn">Google Login</button>
    </div>
  </div>

  <!-- ·ª®ng d·ª•ng ch√≠nh -->
  <div id="main-app" style="display:none;">
    <header>
      <div>
        <span id="app-logo">ChatSocial Platform</span>
      </div>
      <div>
        <button id="switch-theme-btn">Chuy·ªÉn ƒê·ªïi Giao Di·ªán</button>
        <button id="switch-page-btn">Chuy·ªÉn Trang</button>
        <button id="logout-btn">ƒêƒÉng xu·∫•t</button>
      </div>
    </header>
    <!-- Sidebar ch·ª©a th√¥ng tin c√° nh√¢n, danh s√°ch b·∫°n b√®, ng∆∞·ªùi d√πng -->
    <div id="sidebar">
      <div id="user-profile">
        <img src="default-avatar.png" alt="Avatar" id="profile-avatar" style="width:50px;height:50px;border-radius:50%;">
        <h3 id="profile-nickname">Nickname</h3>
        <p id="profile-status">Tr·ª±c tuy·∫øn</p>
        <button id="open-settings-btn">C√†i ƒê·∫∑t</button>
      </div>
      <hr>
      <div id="friend-list">
        <h4>Danh s√°ch b·∫°n b√®</h4>
        <div id="friend-items">
          <!-- C√°c m·ª•c b·∫°n b√® s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
        </div>
        <button id="add-friend-btn">Th√™m b·∫°n b√®</button>
      </div>
      <hr>
      <div id="global-users">
        <h4>Ng∆∞·ªùi d√πng tr·ª±c tuy·∫øn</h4>
        <div id="user-items">
          <!-- Danh s√°ch ng∆∞·ªùi d√πng online -->
        </div>
      </div>
    </div>

    <!-- Khu v·ª±c Chat -->
    <div id="chat-container">
      <div id="chat-toolbar">
        <select id="chat-channel-select">
          <option value="global">K√™nh Chat Th·∫ø Gi·ªõi</option>
          <option value="private">Tr√≤ chuy·ªán ri√™ng</option>
        </select>
        <input type="text" id="chat-message-input" placeholder="Nh·∫≠p tin nh·∫Øn">
        <button id="send-message-btn">G·ª≠i</button>
        <button id="open-emoji-btn">üòä</button>
        <button id="upload-media-btn">T·∫£i ·∫£nh/Video</button>
        <button id="call-btn">G·ªçi ƒëi·ªán/Video Call</button>
      </div>
      <div id="chat-messages" style="display:flex; flex-direction: column;">
        <!-- Chat messages ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y -->
      </div>
    </div>

    <!-- Khu v·ª±c M·∫°ng x√£ h·ªôi -->
    <div id="social-container">
      <div id="post-creation">
        <textarea id="post-content" placeholder="B·∫°n ƒëang nghƒ© g√¨ th·∫ø?"></textarea>
        <br>
        <button id="post-btn">ƒêƒÉng b√†i</button>
        <button id="upload-post-media-btn">T·∫£i ·∫£nh/video</button>
        <select id="post-privacy-select">
          <option value="public">C√¥ng khai</option>
          <option value="friends">B·∫°n b√®</option>
          <option value="private">Ri√™ng t∆∞</option>
        </select>
      </div>
      <hr>
      <div id="posts-container">
        <!-- C√°c b√†i post s·∫Ω ƒë∆∞·ª£c load t·ª´ realtime database -->
      </div>
    </div>

    <!-- Modal C√†i ƒê·∫∑t -->
    <div id="settings-modal" class="modal">
      <h3>C√†i ƒê·∫∑t</h3>
      <label>Ch·ªçn m√†u ch·ªß ƒë·ªÅ (RGB): </label>
      <input type="color" id="theme-color-picker">
      <label>Ch·ªçn font: </label>
      <select id="font-selector">
        <option value="Arial">Arial</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Courier New">Courier New</option>
        <!-- Th√™m font n·∫øu c·∫ßn -->
      </select>
      <br>
      <button id="save-settings-btn">L∆∞u c√†i ƒë·∫∑t</button>
      <button id="close-settings-btn">ƒê√≥ng</button>
    </div>

    <!-- Panel Emoji -->
    <div id="emoji-panel" class="modal">
      <span class="emoji-item">üòÄ</span>
      <span class="emoji-item">üòÇ</span>
      <span class="emoji-item">üòç</span>
      <span class="emoji-item">üòé</span>
      <!-- Th√™m emoji kh√°c -->
      <button id="close-emoji-btn">ƒê√≥ng</button>
    </div>

    <!-- Modal Tr√≤ ch∆°i (√≠t nh·∫•t 30 game) -->
    <div id="games-modal" class="modal">
      <h3>Tr√≤ ch∆°i gi·∫£i tr√≠</h3>
      <div id="games-list">
        <!-- V√≠ d·ª• cho m·ªôt s·ªë game -->
        <button class="game-btn" data-game="game1">Tr√≤ ch∆°i 1</button>
        <button class="game-btn" data-game="game2">Tr√≤ ch∆°i 2</button>
        <button class="game-btn" data-game="game3">Tr√≤ ch∆°i 3</button>
        <!-- ... th√™m ƒë·∫øn 30 game -->
      </div>
      <div id="game-canvas">
        <!-- Game s·∫Ω load v√†o ƒë√¢y -->
      </div>
      <button id="close-games-btn">ƒê√≥ng</button>
    </div>

    <!-- Modal Video Call -->
    <div id="video-call-modal" class="modal">
      <h3>Cu·ªôc g·ªçi video</h3>
      <div id="video-container">
        <!-- Stream c·ªßa Agora s·∫Ω xu·∫•t hi·ªán t·∫°i ƒë√¢y -->
      </div>
      <button id="end-call-btn">K·∫øt th√∫c cu·ªôc g·ªçi</button>
    </div>
  </div>

  <!-- JavaScript t√≠ch h·ª£p c√°c module ch·ª©c nƒÉng -->
  <script>
    // -----------------------
    // C·∫•u h√¨nh & Kh·ªüi t·∫°o
    // -----------------------

    // Firebase configuration ‚Äì THAY TH√îNG TIN C·ª¶A B·∫†N V√ÄO ƒê√ÇY
    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY",
      authDomain: "YOUR_FIREBASE_AUTH_DOMAIN",
      databaseURL: "YOUR_FIREBASE_DATABASE_URL",
      projectId: "YOUR_FIREBASE_PROJECT_ID",
      storageBucket: "YOUR_FIREBASE_STORAGE_BUCKET",
      messagingSenderId: "YOUR_FIREBASE_MESSAGING_SENDER_ID",
      appId: "YOUR_FIREBASE_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);

    // PubNub config ‚Äì THAY PUBNUB KEYS c·ªßa b·∫°n
    const pubnub = new PubNub({
      publishKey: "YOUR_PUBNUB_PUBLISH_KEY",
      subscribeKey: "YOUR_PUBNUB_SUBSCRIBE_KEY",
      uuid: "unique_user_id" // S·∫Ω c·∫≠p nh·∫≠t sau khi ƒëƒÉng nh·∫≠p.
    });

    // Agora config ‚Äì THAY Agora App ID c·ªßa b·∫°n
    const agoraConfig = {
      appId: "YOUR_AGORA_APP_ID"
      // Th√™m c·∫•u h√¨nh token n·∫øu c·∫ßn.
    };

    // -----------------------
    // Khai b√°o bi·∫øn to√†n c·ª•c
    // -----------------------
    let currentUser = null;
    const database = firebase.database();

    // -----------------------
    // H√†m tr·ª£ gi√∫p & ch·ª©c nƒÉng ch√≠nh
    // -----------------------

    // H√†m chuy·ªÉn giao di·ªán s√°ng/t·ªëi
    function switchTheme() {
      if(document.body.classList.contains('light')){
        document.body.classList.replace('light','dark');
      } else {
        document.body.classList.replace('dark','light');
      }
      if(currentUser) {
        database.ref('users/' + currentUser.uid + '/settings').update({ theme: document.body.className });
      }
    }

    // H√†m chuy·ªÉn ƒë·ªïi gi·ªØa trang chat v√† social
    function switchPage() {
      let chatContainer = document.getElementById('chat-container');
      let socialContainer = document.getElementById('social-container');
      if(chatContainer.style.display !== 'none'){
        chatContainer.style.display = 'none';
        socialContainer.style.display = 'block';
      } else {
        socialContainer.style.display = 'none';
        chatContainer.style.display = 'block';
      }
    }

    // H√†m hi·ªÉn th·ªã tin nh·∫Øn chat
    function renderChatMessage(message, type) {
      let chatMessages = document.getElementById('chat-messages');
      let div = document.createElement('div');
      div.classList.add('chat-bubble', type);
      div.textContent = message;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // G·ª≠i tin nh·∫Øn qua PubNub
    function sendMessage() {
      let input = document.getElementById('chat-message-input');
      let message = input.value.trim();
      if(message === "") return;
      let channel = document.getElementById('chat-channel-select').value;
      pubnub.publish({
        channel: channel,
        message: {
          text: message,
          sender: currentUser.nickname || "anonymous",
          timestamp: Date.now()
        }
      });
      renderChatMessage("B·∫°n: " + message, 'sent');
      input.value = "";
    }

    // L·∫Øng nghe tin nh·∫Øn m·ªõi t·ª´ PubNub
    pubnub.addListener({
      message: function(event) {
        renderChatMessage(event.message.sender + ": " + event.message.text, 'received');
      }
    });

    // ƒêƒÉng k√Ω k√™nh chat to√†n c·∫ßu v√† c√° nh√¢n
    function subscribeChannels() {
      pubnub.subscribe({
        channels: ['global']
      });
    }

    // -----------------------
    // X·ª≠ l√Ω login c∆° b·∫£n (kh√¥ng production ‚Äì c·∫ßn b·ªï sung x√°c th·ª±c t·ªët h∆°n)
    // -----------------------
    document.getElementById('login-btn').addEventListener('click', function() {
      let nickname = document.getElementById('login-nickname').value.trim();
      let email = document.getElementById('login-email').value.trim();
      let password = document.getElementById('login-password').value;
      let phone = document.getElementById('login-phone').value.trim();

      if(nickname === ""){
        alert("Vui l√≤ng nh·∫≠p nickname!");
        return;
      }
      currentUser = {
        uid: "user_" + Date.now(),
        nickname: nickname,
        email: email,
        phone: phone,
        settings: { theme: document.body.className }
      };
      database.ref('users/' + currentUser.uid).set(currentUser);
      pubnub.setUUID(currentUser.uid);
      document.getElementById('login-page').style.display = 'none';
      document.getElementById('main-app').style.display = 'block';
      subscribeChannels();
    });

    // ƒêƒÉng nh·∫≠p b·∫±ng Google qua Firebase (m√£ m·∫´u ƒë∆°n gi·∫£n)
    document.getElementById('google-login-btn').addEventListener('click', function() {
      let provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider).then(result => {
        currentUser = {
          uid: result.user.uid,
          nickname: result.user.displayName,
          email: result.user.email,
          photoURL: result.user.photoURL,
          settings: { theme: document.body.className }
        };
        database.ref('users/' + currentUser.uid).set(currentUser);
        pubnub.setUUID(currentUser.uid);
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        subscribeChannels();
      }).catch(error => {
        console.error("Google Login Error", error);
      });
    });

    // ƒêƒÉng xu·∫•t
    document.getElementById('logout-btn').addEventListener('click', function() {
      currentUser = null;
      document.getElementById('main-app').style.display = 'none';
      document.getElementById('login-page').style.display = 'flex';
    });

    // G·ª≠i tin nh·∫Øn khi b·∫•m n√∫t
    document.getElementById('send-message-btn').addEventListener('click', sendMessage);

    // N√∫t chuy·ªÉn giao di·ªán s√°ng/t·ªëi
    document.getElementById('switch-theme-btn').addEventListener('click', switchTheme);
    // N√∫t chuy·ªÉn trang gi·ªØa Chat & Social
    document.getElementById('switch-page-btn').addEventListener('click', switchPage);

    // -----------------------
    // X·ª≠ l√Ω Settings Modal
    // -----------------------
    document.getElementById('open-settings-btn').addEventListener('click', function() {
      document.getElementById('settings-modal').style.display = 'block';
    });
    document.getElementById('close-settings-btn').addEventListener('click', function() {
      document.getElementById('settings-modal').style.display = 'none';
    });
    document.getElementById('save-settings-btn').addEventListener('click', function() {
      let themeColor = document.getElementById('theme-color-picker').value;
      let font = document.getElementById('font-selector').value;
      document.body.style.backgroundColor = themeColor;
      document.body.style.fontFamily = font;
      if(currentUser){
        database.ref('users/' + currentUser.uid + '/settings').update({
          themeColor: themeColor,
          font: font
        });
      }
      document.getElementById('settings-modal').style.display = 'none';
    });

    // -----------------------
    // X·ª≠ l√Ω Emoji Panel
    // -----------------------
    document.getElementById('open-emoji-btn').addEventListener('click', function() {
      document.getElementById('emoji-panel').style.display = 'block';
    });
    document.getElementById('close-emoji-btn').addEventListener('click', function() {
      document.getElementById('emoji-panel').style.display = 'none';
    });
    document.querySelectorAll('.emoji-item').forEach(item => {
      item.addEventListener('click', function(){
        document.getElementById('chat-message-input').value += this.textContent;
        document.getElementById('emoji-panel').style.display = 'none';
      });
    });

    // -----------------------
    // Upload media s·ª≠ d·ª•ng Cloudinary
    // -----------------------
    document.getElementById('upload-media-btn').addEventListener('click', function() {
      cloudinary.openUploadWidget({
        cloudName: 'YOUR_CLOUDINARY_CLOUD_NAME',
        uploadPreset: 'YOUR_UPLOAD_PRESET'
      }, (error, result) => {
        if (!error && result && result.event === "success") {
          console.log("Uploaded file info: ", result.info);
          // G·ª≠i URL media d∆∞·ªõi d·∫°ng tin nh·∫Øn chat.
          renderChatMessage("B·∫°n ƒë√£ g·ª≠i media: " + result.info.secure_url, 'sent');
        }
      });
    });
    document.getElementById('upload-post-media-btn').addEventListener('click', function() {
      cloudinary.openUploadWidget({
        cloudName: 'YOUR_CLOUDINARY_CLOUD_NAME',
        uploadPreset: 'YOUR_UPLOAD_PRESET'
      }, (error, result) => {
        if (!error && result && result.event === "success") {
          createPost("B√†i ƒëƒÉng c√≥ media", result.info.secure_url);
        }
      });
    });

    // -----------------------
    // X·ª≠ l√Ω b√†i ƒëƒÉng m·∫°ng x√£ h·ªôi
    // -----------------------
    function createPost(content, mediaUrl = "") {
      let post = {
        content: content,
        media: mediaUrl,
        author: currentUser ? currentUser.nickname : "anonymous",
        timestamp: Date.now(),
        privacy: document.getElementById('post-privacy-select').value
      };
      let newPostKey = database.ref().child('posts').push().key;
      let updates = {};
      updates['/posts/' + newPostKey] = post;
      database.ref().update(updates);
      renderPost(post);
    }
    function renderPost(post) {
      let container = document.getElementById('posts-container');
      let postDiv = document.createElement('div');
      postDiv.classList.add('post');
      postDiv.style.border = "1px solid #ddd";
      postDiv.style.marginBottom = "10px";
      postDiv.style.padding = "10px";
      let contentP = document.createElement('p');
      contentP.textContent = post.author + " (" + new Date(post.timestamp).toLocaleString() + "): " + post.content;
      postDiv.appendChild(contentP);
      if(post.media !== ""){
        let mediaElem = document.createElement('img');
        mediaElem.src = post.media;
        mediaElem.style.maxWidth = "100%";
        postDiv.appendChild(mediaElem);
      }
      // Ph·∫ßn t√πy ch·ªânh ch√®n plugin b√¨nh lu·∫≠n (v√≠ d·ª•: Facebook Comments)
      let commentsDiv = document.createElement('div');
      commentsDiv.innerHTML = '<!-- Ch√®n m√£ Facebook Comments Plugin ·ªü ƒë√¢y -->';
      postDiv.appendChild(commentsDiv);
      container.prepend(postDiv);
    }
    // L·∫Øng nghe realtime t·ª´ Firebase cho b√†i ƒëƒÉng
    database.ref('posts').on('child_added', function(snapshot) {
      renderPost(snapshot.val());
    });

    // -----------------------
    // X·ª≠ l√Ω Games ‚Äì placeholder cho √≠t nh·∫•t 30 game
    // -----------------------
    document.querySelectorAll('.game-btn').forEach(btn => {
      btn.addEventListener('click', function(){
        loadGame(this.getAttribute('data-game'));
      });
    });
    function loadGame(gameId) {
      let gameCanvas = document.getElementById('game-canvas');
      gameCanvas.innerHTML = "<p>ƒêang t·∫£i " + gameId + "...</p>";
      // T·∫°i ƒë√¢y b·∫°n c√≥ th·ªÉ t√≠ch h·ª£p c√°c tr√≤ ch∆°i d·ª±a tr√™n Canvas, WebGL hay lib JS kh√°c.
    }
    // V√≠ d·ª•: m·ªü/ƒë√≥ng modal game t·ª´ n√∫t (·ªü ƒë√¢y d√πng n√∫t Th√™m b·∫°n b√® nh∆∞ m·ªôt decoy)
    document.getElementById('add-friend-btn').addEventListener('click', function(){
      document.getElementById('games-modal').style.display = 'block';
    });
    document.getElementById('close-games-btn').addEventListener('click', function(){
      document.getElementById('games-modal').style.display = 'none';
    });

    // -----------------------
    // X·ª≠ l√Ω Video Call v·ªõi Agora (placeholder)
    // -----------------------
    document.getElementById('call-btn').addEventListener('click', function(){
      document.getElementById('video-call-modal').style.display = 'block';
      startAgoraCall();
    });
    document.getElementById('end-call-btn').addEventListener('click', function(){
      endAgoraCall();
      document.getElementById('video-call-modal').style.display = 'none';
    });
    function startAgoraCall() {
      let videoContainer = document.getElementById('video-container');
      videoContainer.innerHTML = "<p>ƒêang k·∫øt n·ªëi cu·ªôc g·ªçi video v·ªõi Agora...</p>";
      // T√≠ch h·ª£p AgoraRTC client v√† c√°c logic join/leave channel.
    }
    function endAgoraCall() {
      console.log("Cu·ªôc g·ªçi k·∫øt th√∫c.");
    }

    // -----------------------
    // Ch·ª©c nƒÉng b·∫£o m·∫≠t & ch·ªëng sao ch√©p code
    // -----------------------
    document.addEventListener('keydown', function(e) {
      // V√≠ d·ª•: v√¥ hi·ªáu h√≥a Ctrl+Shift+I (d√πng ƒë·ªÉ m·ªü DevTools)
      if(e.ctrlKey && e.shiftKey && e.keyCode === 73) {
        e.preventDefault();
      }
    });

    // -----------------------
    // Update tr·∫°ng th√°i online/offline ng∆∞·ªùi d√πng
    // -----------------------
    window.addEventListener('load', () => {
      if(currentUser){
        database.ref('users/' + currentUser.uid + '/status').set("online");
      }
    });
    window.addEventListener('beforeunload', () => {
      if(currentUser){
        database.ref('users/' + currentUser.uid + '/status').set("offline");
      }
    });

    // -----------------------
    // Ph√≠m t·∫Øt cho tr·∫£i nghi·ªám ng∆∞·ªùi d√πng t·ªët h∆°n
    // -----------------------
    document.addEventListener('keydown', function(e) {
      if(e.key === "Enter" && document.activeElement === document.getElementById('chat-message-input')) {
        sendMessage();
      }
      if(e.ctrlKey && e.key === "m") {
        document.getElementById('settings-modal').style.display = 'block';
      }
    });

    // -----------------------
    // V√≠ d·ª• Animation v·ªõi anime.js
    // -----------------------
    anime({
      targets: '#app-logo',
      translateY: [-20, 0],
      opacity: [0,1],
      duration: 1000,
      easing: 'easeOutExpo'
    });
  </script>
</body>
</html>
