<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nền tảng Chat & Mạng Xã Hội</title>
  <!-- CSS bên trong file chính (không dùng thư mục con hay cài đặt dòng lệnh) -->
  <style>
    /* Reset & cấu hình cơ bản */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(90deg, #e3ffe7 0%, #d9e7ff 100%);
      color: #333;
      overflow-x: hidden;
    }
    h1, h2, h3 { margin-bottom: 10px; }
    button { cursor: pointer; padding: 8px 16px; border: none; border-radius: 5px; background: #2196F3; color: #fff; }
    button:hover { background: #1976D2; }
    input, textarea, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    /* Các trang */
    .page { width: 100%; min-height: 100vh; padding: 20px; }
    #mainPage { display: flex; flex-direction: column;}
    /* Thanh điều hướng */
    #navBar {
      display: flex;
      justify-content: space-around;
      align-items: center;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 10px 0;
      position: sticky; top: 0;
      z-index: 100;
    }
    #navBar button { background: none; border: none; font-size: 16px; }
    #navBar button:hover { color: #1976D2; }
    /* Các content page */
    .contentPage { display: none; padding: 20px; }
    /* Chat page layout */
    #chatPage { display: flex; flex-wrap: wrap; }
    #globalChatContainer {
      flex: 2;
      border-right: 1px solid #ddd;
      padding: 10px;
      max-height: 70vh;
      overflow-y: auto;
    }
    #chatMessages { margin-bottom: 10px; }
    .chatBubble {
      padding: 8px;
      margin: 5px 0;
      background: #f1f1f1;
      border-radius: 10px;
      width: fit-content;
      max-width: 80%;
    }
    #chatSidebar {
      flex: 1;
      padding: 10px;
      max-height: 70vh;
      overflow-y: auto;
    }
    /* Mạng xã hội (feed) */
    #postsFeed { margin-top: 15px; }
    .postItem {
      border: 1px solid #ddd;
      background: #fff;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
    }
    /* Profile page */
    #profileInfo { text-align: center; }
    #profileAvatar { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; }
    #profileCover { width: 100%; height: 200px; object-fit: cover; margin-bottom: 10px; }
    /* Notification area (float) */
    #notificationArea {
      position: fixed;
      bottom: 15px;
      right: 15px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      padding: 10px 15px;
      border-radius: 5px;
      font-size: 14px;
    }
    /* Call container */
    #callContainer {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #callVideo { width: 80%; height: 60%; background: #000; }
    /* Hiệu ứng động & các custom theme (sẽ được cập nhật động qua JS) */
  </style>

  <!-- Thư viện hiệu ứng anime.js -->
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <!-- Firebase (với phiên bản compat cho dễ tích hợp) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <!-- PubNub cho chat realtime -->
  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.29.9.min.js"></script>
  <!-- Agora.io cho voice, video và group call -->
  <script src="https://cdn.agora.io/sdk/release/AgoraRTC_N.js"></script>
  <!-- Facebook comment plugin -->
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v14.0"></script>
  <!-- Các thư viện JS giao diện khác (nếu cần) có thể thêm theo dạng CDN -->
</head>
<body>
  <!-- Trang đăng nhập -->
  <div id="loginPage" class="page">
    <h1>Chào mừng đến với Nền tảng Chat & MXH Đỉnh Cao</h1>
    <!-- Chọn giao diện đăng nhập -->
    <div id="loginOptions">
      <button id="loginEmail">Đăng nhập bằng Email</button>
      <button id="loginPhone">Đăng nhập bằng SĐT</button>
      <button id="loginGoogle">Đăng nhập bằng Google</button>
    </div>
    <!-- Form đăng nhập Email/Password -->
    <div id="emailLoginForm" style="display:none; margin-top:15px;">
      <input type="text" id="loginEmailInput" placeholder="Nhập Email..." />
      <input type="password" id="loginPassword" placeholder="Nhập mật khẩu..." />
      <div style="margin-top:10px;">
        <button id="btnSignIn">Đăng nhập</button>
        <button id="btnRegister">Đăng ký</button>
      </div>
    </div>
  </div>

  <!-- Trang chính chứa các chức năng: chat, mạng xã hội, profile, trò chơi, cài đặt -->
  <div id="mainPage" class="page" style="display:none;">
    <!-- Thanh điều hướng chính -->
    <div id="navBar">
      <button data-page="chat">Chat</button>
      <button data-page="social">Mạng xã hội</button>
      <button data-page="profile">Hồ sơ</button>
      <button data-page="games">Trò chơi</button>
      <button data-page="settings">Cài đặt</button>
    </div>

    <!-- Trang Chat trực tuyến -->
    <div id="chatPage" class="contentPage" style="display:block;">
      <h2>Chat trực tuyến</h2>
      <div style="display: flex; flex-wrap: wrap;">
        <!-- Khu vực chat toàn cục -->
        <div id="globalChatContainer">
          <div id="chatMessages">
            <!-- Tin nhắn chat hiện ra ở đây -->
          </div>
          <div style="margin-top:10px;">
            <input type="text" id="chatInput" placeholder="Nhập tin nhắn..." style="width:80%;" />
            <button id="sendChat">Gửi</button>
          </div>
        </div>
        <!-- Sidebar: danh sách bạn bè & danh bạ trò chuyện riêng -->
        <div id="chatSidebar">
          <div id="friendsList">
            <h3>Danh bạ bạn bè</h3>
            <!-- Danh sách bạn bè sẽ được load ở đây -->
          </div>
          <div id="recentChats" style="margin-top:15px;">
            <h3>Trò chuyện riêng</h3>
            <!-- Danh sách chat riêng -->
          </div>
        </div>
      </div>
    </div>

    <!-- Trang Mạng xã hội (Feed, bài đăng) -->
    <div id="socialPage" class="contentPage">
      <h2>Mạng xã hội</h2>
      <!-- Khu vực tạo bài đăng -->
      <div id="postCreation" style="margin-bottom:20px; border:1px solid #ddd; padding:10px; border-radius:8px; background:#fff;">
        <textarea id="postText" placeholder="Chia sẻ cảm xúc của bạn..." style="width:100%; height:80px;"></textarea>
        <div style="margin-top:10px;">
          <input type="file" id="postImage" accept="image/*" />
          <button id="submitPost">Đăng bài</button>
        </div>
        <!-- Lựa chọn phân quyền: công khai, bạn bè (có thể mở rộng thêm) -->
        <div style="margin-top:10px;">
          <select id="postVisibility">
            <option value="public">Công khai</option>
            <option value="friends">Bạn bè</option>
          </select>
        </div>
      </div>
      <!-- Feed hiển thị bài đăng -->
      <div id="postsFeed">
        <!-- Mỗi bài đăng sẽ được render động -->
      </div>
    </div>

    <!-- Trang Hồ sơ cá nhân -->
    <div id="profilePage" class="contentPage">
      <h2>Trang hồ sơ của bạn</h2>
      <div id="profileInfo">
        <img id="profileCover" src="default-cover.png" alt="Ảnh bìa">
        <img id="profileAvatar" src="default-avatar.png" alt="Ảnh đại diện">
        <h3 id="profileNickname">Nickname của bạn</h3>
        <p id="profileDetails">Các thông tin cá nhân (email, SĐT... tùy quyền hiển thị)</p>
      </div>
      <!-- Tùy chỉnh giao diện & cá nhân hóa -->
      <div id="profileCustomization" style="margin-top:20px;">
        <label for="bgColor">Chọn màu nền:</label>
        <input type="color" id="bgColor" value="#ffffff" />
        <button id="saveTheme">Lưu Theme</button>
      </div>
      <!-- Liên kết nhạc trên profile (ví dụ Audiomack) -->
      <div id="musicLink" style="margin-top:15px;">
        <input type="text" id="musicURL" placeholder="Dán link nhạc (Audiomack)..." style="width:70%;" />
        <button id="saveMusicLink">Lưu đường dẫn</button>
      </div>
    </div>

    <!-- Trang Trò chơi -->
    <div id="gamesPage" class="contentPage">
      <h2>Trò chơi giải trí</h2>
      <div id="gamesList">
        <!-- Danh sách game: Mỗi nhóm sẽ chứa ít nhất 1 game, tổng cộng tối thiểu 100 game.
             Ở đây, bạn có thể render các iframe hoặc canvas game khi tích hợp -->
        <p>Danh sách game sẽ được load ở đây...</p>
      </div>
    </div>

    <!-- Trang Cài đặt -->
    <div id="settingsPage" class="contentPage">
      <h2>Cài đặt hệ thống</h2>
      <div id="appSettings" style="padding:10px; border:1px solid #ddd; background:#fff; border-radius:8px;">
        <label>
          <input type="checkbox" id="notificationToggle" />
          Bật thông báo
        </label>
        <br>
        <label>
          <input type="checkbox" id="preventSleepToggle" />
          Chế độ chống tắt màn hình
        </label>
        <br>
        <label for="themeSelect">Chọn Theme:</label>
        <select id="themeSelect">
          <option value="default">Mặc định</option>
          <option value="dark">Chế độ Tối</option>
          <!-- Thêm thêm khoảng 20 theme ở đây -->
        </select>
      </div>
      <!-- Khối nhúng plugin bình luận Facebook -->
      <div style="margin-top:20px;">
        <div class="fb-comments" data-href="http://yourdomain.com" data-width="100%" data-numposts="5"></div>
      </div>
    </div>
  </div>

  <!-- Khu vực thông báo (floating notifications) -->
  <div id="notificationArea"></div>

  <!-- Container cho cuộc gọi (voice/video) từ Agora.io -->
  <div id="callContainer" style="display:none;">
    <div id="callVideo"></div>
    <button id="endCall">Kết thúc cuộc gọi</button>
  </div>

  <!-- Script JS tích hợp và hiệu ứng (sử dụng toàn bộ trong file, không dùng module hay subfolder) -->
  <script>
    /************************************************
     * KHỞI TẠO & CẤU HÌNH DỊCH VỤ
     ************************************************/
    // Firebase: Thay các giá trị YOUR_... bằng cấu hình thực của bạn (lấy từ console.firebase.google.com)
    const firebaseConfig = {
  apiKey: "AIzaSyCeYwTT7E8bi7bccIrc20MTe5S4r0e0wUI",
  authDomain: "webai-7642b.firebaseapp.com",
  databaseURL: "https://webai-7642b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "webai-7642b",
  storageBucket: "webai-7642b.firebasestorage.app",
  messagingSenderId: "967881370128",
  appId: "1:967881370128:web:e5c4b06e4f70f55a68b895",
  measurementId: "G-61XJ390Q30"
    };
    firebase.initializeApp(firebaseConfig);

    // PubNub: Thay API key của bạn
    var pubnub = new PubNub({
      publishKey: "pub-c-9ad32978-37b1-4f15-bc57-bac1884507a4",
      subscribeKey: "sub-c-0269ec54-430f-41b1-8a33-4200f566fcbb"
    });

    /************************************************
     * GLOBAL STATE & HÀM HỖ TRỢ
     ************************************************/
    let appState = {
      user: null,
      activePage: 'chat',
      themes: {
        default: { bg: "#ffffff" },
        dark: { bg: "#333333" }
        // Thêm themes khác (có thể đến 20 theme) cùng cấu trúc tuỳ chỉnh màu sắc, RGB, ...
      },
      // Các trạng thái khác: danh sách bạn bè, danh sách chat riêng, cấu hình cài đặt, v.v.
    };

    // Hàm chuyển đổi hiển thị giữa các trang con
    function showPage(pageName) {
      document.querySelectorAll(".contentPage").forEach(page => {
        page.style.display = "none";
      });
      document.getElementById(pageName + "Page").style.display = "block";
      appState.activePage = pageName;
    }

    /************************************************
     * XỬ LÝ ĐĂNG NHẬP/ĐĂNG KÝ
     ************************************************/
    // Hiển thị form khi nhấn "Đăng nhập bằng Email"
    document.getElementById("loginEmail").addEventListener("click", () => {
      document.getElementById("emailLoginForm").style.display = "block";
    });

    // Đăng nhập (Email/Password)
    document.getElementById("btnSignIn").addEventListener("click", () => {
      const email = document.getElementById("loginEmailInput").value;
      const password = document.getElementById("loginPassword").value;
      firebase.auth().signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          appState.user = userCredential.user;
          document.getElementById("loginPage").style.display = "none";
          document.getElementById("mainPage").style.display = "block";
        })
        .catch(error => {
          alert("Lỗi đăng nhập: " + error.message);
        });
    });

    // Đăng ký (Email/Password)
    document.getElementById("btnRegister").addEventListener("click", () => {
      const email = document.getElementById("loginEmailInput").value;
      const password = document.getElementById("loginPassword").value;
      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          appState.user = userCredential.user;
          // Khởi tạo dữ liệu người dùng trong Database nếu cần
          document.getElementById("loginPage").style.display = "none";
          document.getElementById("mainPage").style.display = "block";
        })
        .catch(error => {
          alert("Lỗi đăng ký: " + error.message);
        });
    });

    // Đăng nhập bằng Google
    document.getElementById("loginGoogle").addEventListener("click", () => {
      var provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider).then(result => {
        appState.user = result.user;
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("mainPage").style.display = "block";
      }).catch(error => {
        alert("Lỗi đăng nhập Google: " + error.message);
      });
    });

    // Tương tự, bạn có thể tích hợp đăng nhập bằng SĐT với Firebase Phone Auth

    /************************************************
     * TÍNH NĂNG CHAT REALTIME (sử dụng PubNub)
     ************************************************/
    // Gửi tin nhắn
    document.getElementById("sendChat").addEventListener("click", () => {
      let message = document.getElementById("chatInput").value;
      if(message.trim() !== ""){
        pubnub.publish({
          channel: "globalChat",
          message: {
            user: appState.user ? (appState.user.email || appState.user.phoneNumber || "User") : "Guest",
            text: message,
            time: Date.now()
          }
        }, (status, response) => {
          if(status.error) {
            console.log("Lỗi gửi tin nhắn:", status);
          } else {
            document.getElementById("chatInput").value = "";
          }
        });
      }
    });
    // Subscribe kênh chat toàn cục
    pubnub.subscribe({ channels: ["globalChat"] });
    pubnub.addListener({
      message: function(event) {
        let msg = event.message;
        let chatMessages = document.getElementById("chatMessages");
        let msgDiv = document.createElement("div");
        msgDiv.className = "chatBubble";
        msgDiv.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;
        chatMessages.appendChild(msgDiv);
        // Tự động cuộn xuống cuối hộp chat
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    });

    /************************************************
     * TÍNH NĂNG ĐĂNG BÀI (MẠNG XÃ HỘI)
     ************************************************/
    document.getElementById("submitPost").addEventListener("click", () => {
      let postText = document.getElementById("postText").value;
      let visibility = document.getElementById("postVisibility").value;
      // Xử lý upload hình ảnh qua Cloudinary (placeholder – cần triển khai API thực)
      let imageUrl = "";
      if(document.getElementById("postImage").files.length > 0){
        // TODO: Upload file tới Cloudinary và lấy URL trả về
        imageUrl = "https://example.com/path/to/uploaded_image.png";
      }
      let postData = {
        user: appState.user ? appState.user.uid : "guest",
        text: postText,
        image: imageUrl,
        visibility: visibility,  // public hoặc friends
        time: Date.now()
      };
      firebase.database().ref("posts").push(postData)
        .then(() => {
          // Xóa dữ liệu form sau khi đăng bài
          document.getElementById("postText").value = "";
          document.getElementById("postImage").value = "";
        })
        .catch(error => {
          console.error("Lỗi đăng bài:", error);
        });
    });

    // Hàm lắng nghe và render bài đăng từ Firebase
    firebase.database().ref("posts").on("child_added", snapshot => {
      let post = snapshot.val();
      let postFeed = document.getElementById("postsFeed");
      let postDiv = document.createElement("div");
      postDiv.className = "postItem";
      postDiv.innerHTML = `
        <p><strong>User:</strong> ${post.user}</p>
        <p>${post.text}</p>
        ${ post.image ? `<img src="${post.image}" alt="Ảnh bài đăng" style="max-width:100%; border-radius:5px;">` : "" }
        <p style="font-size:12px; color:#777;">${new Date(post.time).toLocaleString()}</p>
      `;
      postFeed.prepend(postDiv);
    });

    /************************************************
     * TÍNH NĂNG HỒ SƠ & CÁ NHÂN HÓA
     ************************************************/
    // Lưu thay đổi theme (màu nền) người dùng chọn ở profile
    document.getElementById("saveTheme").addEventListener("click", () => {
      let selectedColor = document.getElementById("bgColor").value;
      document.body.style.backgroundColor = selectedColor;
      // Cập nhật lưu trữ cho người dùng (có thể lưu trên Firebase dưới node "settings")
      // firebase.database().ref("users/" + appState.user.uid + "/settings").update({ themeColor: selectedColor });
    });

    // Lưu liên kết nhạc trên profile
    document.getElementById("saveMusicLink").addEventListener("click", () => {
      let url = document.getElementById("musicURL").value;
      // Lưu liên kết nhạc vào hồ sơ người dùng (có thể lấy embed từ Audiomack)
      // firebase.database().ref("users/" + appState.user.uid + "/music").set({ url: url });
      alert("Liên kết nhạc đã được lưu!");
    });

    /************************************************
     * TÍNH NĂNG CUỘC GỌI (Voice, Video, Group Call qua Agora.io)
     ************************************************/
    // Giả lập mở cuộc gọi (các hàm chưa tích hợp đầy đủ Agora)
    // Ví dụ: bạn có thể thêm một nút mở cuộc gọi trong UI và chạy hàm này
    document.getElementById("startCall") && document.getElementById("startCall").addEventListener("click", () => {
      // Khởi tạo AgoraRTC, join channel, hiển thị video của đối phương
      document.getElementById("callContainer").style.display = "block";
      // TODO: Thêm logic kết nối kênh gọi
    });
    document.getElementById("endCall").addEventListener("click", () => {
      // Kết thúc cuộc gọi
      document.getElementById("callContainer").style.display = "none";
      // TODO: Logic dừng cuộc gọi và giải phóng tài nguyên
    });

    /************************************************
     * TÍNH NĂNG THÔNG BÁO & ONLINE/OFFLINE
     ************************************************/
    // Kiểm tra trạng thái kết nối định kỳ
    window.addEventListener('load', () => {
      setInterval(() => {
        let status = navigator.onLine ? "Online" : "Offline";
        document.getElementById("notificationArea").innerText = "Trạng thái: " + status;
      }, 3000);
    });

    // Thông báo mới (có thể dùng Notification API của trình duyệt)
    function showNotification(message) {
      let notif = document.getElementById("notificationArea");
      notif.innerText = message;
      setTimeout(() => { notif.innerText = ""; }, 5000);
    }

    /************************************************
     * TÍNH NĂNG PHÍM TẮT & SHORTCUTS
     ************************************************/
    document.addEventListener("keydown", function(event) {
      // Ví dụ: Ctrl+Enter sẽ kích hoạt gửi tin nhắn hoặc một lệnh nào đó
      if(event.ctrlKey && event.key === "Enter"){
        document.getElementById("sendChat").click();
      }
      // Thêm các phím tắt khác theo nhu cầu
    });

    /************************************************
     * HIỆU ỨNG VỚI ANIME.JS VÀ CÁC HIỆU ỨNG KHÁC
     ************************************************/
    // Hiệu ứng khi load trang đăng nhập
    anime({
      targets: 'h1',
      translateY: [-50, 0],
      opacity: [0, 1],
      duration: 1000,
      easing: 'easeOutExpo'
    });

    /************************************************
     * CHẾ ĐỘ CHỐNG TẮT MÀN HÌNH (Wake Lock API – nếu trình duyệt hỗ trợ)
     ************************************************/
    if ('wakeLock' in navigator) {
      let wakeLock = null;
      navigator.wakeLock.request('screen').then(lock => {
        wakeLock = lock;
      }).catch(err => {
        console.error("Không thể kích hoạt Wake Lock: ", err);
      });
    }

    /************************************************
     * LƯU TRỮ DỮ LIỆU LOCAL (LocalStorage / Firebase)
     ************************************************/
    // Ví dụ: lưu các cuộc trò chuyện, bài đăng, cài đặt của người dùng để tránh mất dữ liệu khi load lại.
    // Khi tải lại trang, bạn có thể đọc từ Firebase hoặc localStorage và populate vào UI.

    /************************************************
     * TÍNH NĂNG PHỤ: GAME, EMOJI, CHỤP ẢNH & CÁC HIỆU ỨNG NÂNG CAO
     ************************************************/
    // - Tích hợp một danh mục game (ít nhất 100 game) có thể được load qua iframe hoặc canvas.
    // - Cho phép đăng, sử dụng emoji, ký hiệu đặc biệt.
    // - Cho phép người dùng chụp ảnh và đăng ngay trong chat/bài đăng thông qua API getUserMedia.
    // - Tạo hiệu ứng chat bong bóng, tùy chỉnh giao diện, background động, cho phép tải về ảnh nền.

    // Bạn có thể mở rộng các hàm trên theo hướng dẫn chi tiết của từng API (Cloudinary, Agora, Audiomack, …)

    /************************************************
     * CHÚ Ý:
     * - Tất cả các chức năng lưu trữ (chat, bài đăng, cài đặt, danh bạ, lịch sử cuộc gọi)
     *   phải được lưu trong Firebase Realtime Database/Firestore và Storage.
     * - Bảo mật và quyền riêng tư người dùng cần được cài đặt qua Firebase Security Rules.
     * - Tất cả các nút, thao tác và hiệu ứng được làm “nặng” để đảm bảo trải nghiệm đỉnh,
     *   nhưng bạn cần tối ưu để không gây ảnh hưởng quá lớn tới hiệu năng.
     * - Các API tích hợp (Agora, PubNub, Cloudinary, Facebook Plugin, Google Sign-In, …)
     *   cần được thay thế bằng khoá API thật khi triển khai.
     ************************************************/

    // Cuối cùng, khởi tạo các listeners và load dữ liệu cần thiết khi người dùng đăng nhập thành công.
  </script>
</body>
</html>
