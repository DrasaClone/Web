# .github/workflows/build-capacitor-android.yml
name: Build Capacitor Android APK

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Capacitor CLI
        run: npm install -g @capacitor/cli

      - name: Initialize Capacitor project
        run: |
          npm install # install dependencies and ensure 'www/' exists
          npx cap init DrasaCloneWeb com.drasaclone.web --web-dir=www --force

      - name: Add Android platform
        run: npx cap add android --npm-client npm

      - name: Copy web assets
        run: npx cap copy android

      - name: Configure Android
        run: |
          # Allow all navigation within WebView
          sed -i '/<activity/a \    <intent-filter>\n      <action android:name="android.intent.action.VIEW" />\n      <category android:name="android.intent.category.DEFAULT" />\n      <category android:name="android.intent.category.BROWSABLE" />\n      <data android:scheme="https" android:host="drasaclone.github.io" />\n    </intent-filter>' android/app/src/main/AndroidManifest.xml

      - name: Build APK
        run: |
          cd android && ./gradlew clean assembleDebug

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: drasaclone-capacitor-apk
          path: android/app/build/outputs/apk/debug/app-debug.apk

# Notes:
# - This uses Capacitor instead of Cordova/Bubblewrap.
# - No interactive prompts; fully non-interactive build of universal, debug-signed APK.
# - Install 'app-debug.apk' on Android (enable unknown sources, uninstall previous version).
